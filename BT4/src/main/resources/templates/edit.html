<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{_layout}">
<head>
    <title>Chỉnh sửa Sản phẩm</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="page-header">
            <h1>Chỉnh sửa Sản phẩm</h1>
            <p class="text-muted">Cập nhật thông tin sản phẩm</p>
        </div>

        <div class="form-section">
            <form th:action="@{/products/update/{code}(code=${product.productCode})}" 
                  th:object="${product}" method="post" novalidate enctype="multipart/form-data">
                
                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <span th:text="${error}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                
                <div class="mb-3">
                    <label for="productCode" class="form-label">Mã Sản phẩm</label>
                    <input type="text" class="form-control" id="productCode" th:field="*{productCode}" readonly>
                </div>

                <div class="mb-3">
                    <label for="productName" class="form-label">Tên Sản phẩm <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="productName" th:field="*{productName}"
                           th:class="form-control + ${#fields.hasErrors('productName') ? ' is-invalid' : ''}">
                    <div th:if="${#fields.hasErrors('productName')}" class="invalid-feedback">
                        <span th:errors="*{productName}"></span>
                    </div>
                    <small class="form-text text-muted">Tối đa 100 ký tự</small>
                </div>

                <div class="mb-3">
                    <label for="price" class="form-label">Giá Sản phẩm <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="price" th:field="*{price}"
                           min="1" max="9999999"
                           th:class="form-control + ${#fields.hasErrors('price') ? ' is-invalid' : ''}">
                    <div th:if="${#fields.hasErrors('price')}" class="invalid-feedback">
                        <span th:errors="*{price}"></span>
                    </div>
                    <small class="form-text text-muted">Từ 1 đến 9,999,999 đ</small>
                </div>

                <div class="mb-3">
                    <label class="form-label">Hình ảnh hiện tại</label>
                    <div th:if="${product.image != null}" class="card" style="max-width: 200px;">
                        <div class="card-body">
                            <p class="mb-0"><small th:text="'Tên file: ' + ${product.image}"></small></p>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="imageFile" class="form-label">Cập nhật Hình ảnh Sản phẩm</label>
                    <input type="file" class="form-control" id="imageFile" name="imageFile" accept="image/*">
                    <small class="form-text text-muted">Chỉ chấp nhận file ảnh, dung lượng tối đa 5MB. Để trống nếu không muốn thay đổi</small>
                </div>

                <div class="mb-3">
                    <label for="category" class="form-label">Danh mục <span class="text-danger">*</span></label>
                    <select class="form-select" id="category" th:field="*{category}"
                            th:class="form-select + ${#fields.hasErrors('category') ? ' is-invalid' : ''}">
                        <option value="">-- Chọn danh mục --</option>
                        <option th:each="cat : ${categories}" th:value="${cat}" th:text="${cat}"></option>
                    </select>
                    <div th:if="${#fields.hasErrors('category')}" class="invalid-feedback">
                        <span th:errors="*{category}"></span>
                    </div>
                </div>

                <div class="mb-3">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Cập nhật
                    </button>
                    <a href="/products" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Quay lại
                    </a>
                    <a th:href="@{/products/delete/{code}(code=${product.productCode})}"
                       onclick="return confirm('Bạn chắc chắn muốn xóa sản phẩm này?')"
                       class="btn btn-danger">
                        <i class="bi bi-trash"></i> Xóa sản phẩm
                    </a>
                </div>
            </form>
        </div>

        <div class="alert alert-info mt-3">
            <strong>Lưu ý:</strong>
            <ul class="mb-0">
                <li>Tên sản phẩm không được để trống</li>
                <li>Giá phải từ 1 đến 9,999,999 đ</li>
                <li>Vui lòng chọn danh mục</li>
                <li>Có thể cập nhật hình ảnh hoặc giữ nguyên hình ảnh cũ</li>
            </ul>
        </div>
    </div>
</body>
</html>
